VS Code 中的 AKS 工具和诊断功能


====================================

VS Code 中的 AKS 工具和诊断功能


本文档将向您介绍如何直接通过 Visual Studio Code 与您的 AKS 集群进行交互。Azure Kubernetes 服务是一项完全托管的 Kubernetes 服务。Azure Kubernetes 服务（AKS）提供了无服务器 Kubernetes 环境、持续集成和持续交付（CI/CD）体验，并具备企业级安全和治理功能。Azure Kubernetes 服务（AKS）是一个开源系统，用于自动化容器化应用的部署、扩展和管理。



我们将向您展示如何对您的AKS集群进行诊断性健康检查、启动AKS Periscope进行更深入的故障排除、部署Azure服务运营商，或生成GitHub Actions入门工作流。
 


开始之前，请先阅读以下说明：


 ----------------  


AKS VS Code 扩展对 Kubernetes VS Code 扩展存在父子依赖关系。



您需要下载 Kubernetes VS Code 扩展程序。
 

您可以按照本指南在现有 AKS 集群上进行操作，也可以在创建新的 AKS 集群时参考此指南。




安装 Azure Kubernetes 服务扩展程序


-----------------------------------------------
若想获得完全集成的 Azure Kubernetes 诊断体验，您可以安装 Azure Kubernetes 服务工具扩展程序。
 

通过该扩展程序，您可以轻松地在 Visual Studio Code 环境中查看和管理您的 AKS 集群。
 

若要安装 Azure Kubernetes 服务 VS Code 扩展，请打开扩展视图（Windows 系统下按 ⇧⌘X，Linux 系统下按 Ctrl+Shift+X）并搜索“AKS”。然后选择“Microsoft Azure Kubernetes Services”扩展程序即可。






Installation
------------
• 下载并安装适用于VS Code的Azure Kubernetes Service扩展程序。
 
等待扩展程序完成安装后，系统会提示重新加载VS Code，此时请按提示操作。


安装完成后，您将在“云”选项卡下看到一个名为“Azure”的板块。


• 选择“登录 Azure”来登录您的 Azure 账户……





功能特性


--------
成功使用 Azure 账户登录后，您可以在名为 "Azure" 的板块下查看 Azure 订阅中的所有 AKS 集群。您可以右键单击您的 AKS 集群，并选择菜单项来执行以下操作。



针对集群运行 AKS 诊断工具：





启动 GitHub 工作流：





运行 Kubectl 命令：






合并到 Kubeconfig 配置文件中


---------------------
右键单击您的 AKS 集群，选择“合并到 Kubeconfig”即可将所选的 AKS 集群添加到您的活动 Kubeconfig 文件中。
 


保存 Kubeconfig 文件


---------------
右键单击您的 AKS 集群，然后选择 "保存 Kubeconfig"，即可将所选 AKS 集群的 Kubeconfig 文件另存为新文件。




AKS 诊断工具


---------------
右键单击您的 AKS 集群，选择“运行 AKS 诊断”，以根据您的 AKS 集群的后端遥测数据，显示以下方面的诊断信息：



• 最佳实践


• 创建、升级、删除和扩展问题


• 身份与安全


• 网络与连接问题  


• 节点健康状况


若要对您的 AKS 集群进行进一步检查，以排除故障并获取推荐的解决方案，请在页面顶部选择 "AKS 诊断" 链接，为所选集群打开诊断界面。有关 AKS 诊断的更多信息，请访问 "AKS 诊断概述" 页面。






在 Azure 门户中导航至您的集群


----------------------------------------------
右键单击您的 AKS 集群，然后选择"在 Azure 门户中显示"，即可在 Azure 门户中打开该集群的概览页面。
 


显示 AKS 集群属性


---------------------------
右键单击您的 AKS 集群，选择 "显示属性"，即可查看 AKS 集群和代理池的相关属性，例如预配状态、FQDN、Kubernetes 版本等；同时，还可查看节点的属性，包括节点版本、虚拟机类型、虚拟机大小、操作系统类型、操作系统磁盘大小以及节点的预配状态等。




AKS Periscope


-------------
右键单击您的 AKS 集群，选择“运行 AKS 透镜”，即可从 AKS 集群提取详细诊断信息并将其导出至 Azure 存储账户。选择该选项后，将加载一个网页界面，您可在此生成可下载的日志链接，以及有效期为 7 天的可共享链接。



如果您未能查看所有节点的日志记录，可能是因为日志上传仍在进行中。请再次点击“生成链接”按钮，以加载更多日志信息。
 

欲了解更多信息，请访问AKS Periscope平台。





配置存储账户  



运行 AKS 诊断洞察（Periscope）功能时，您需要确保您的 AKS 集群的诊断设置与一个存储账户相关联。



如果您的AKS集群的诊断设置仅关联了一个存储账户，默认情况下，收集到的日志将存储在该关联的存储账户中。



如果你的AKS集群的诊断设置关联了多个存储账户，那么扩展程序会提示你选择用于保存收集日志的存储账户。
 

如果您在诊断设置中没有配置存储账户，可以按照以下步骤启用它：



• 右键单击您的 AKS 集群，选择 "在 Azure 门户中显示"。


• 在左侧导航栏中的“监控”选项下，选择“诊断设置”。
 
• 选择“添加诊断设置”。


• 输入一个名称，例如 myAKSClusterLogs，然后选择将其归档到存储账户的选项。


• 选择一个你喜欢的存储账户。


• 在可用日志列表中，选择您希望启用的日志。注意：产生的费用将根据您的存储账户使用情况和 Azure 存储策略进行计算。


准备就绪后，请选择“保存”以启用所选日志的收集功能。
 
有关诊断设置的更多信息，请访问"创建诊断设置"页面，了解如何将平台日志和指标发送至不同目标平台。




安装 Azure 服务运营商


------------------------------
右键单击您的AKS集群，选择“安装Azure服务运营商”，即可轻松在AKS集群上部署最新版本的Azure服务运营商（ASO），并在Kubernetes中配置Azure资源。选择此选项后，系统将提示您提供一个用于执行Azure资源操作的ASO服务主体。该服务主体必须具有适当的权限（通常为适当作用域下的贡献者权限）。填写服务主体详细信息后，选择“提交”即可启动Azure服务运营商的安装过程。



安装 Azure 服务运营商（Azure Service Operator）仅能在此前从未安装过 ASO 的 AKS 集群上进行操作。若您已手动启动过安装流程，请遵循 Azure 服务运营商的相关指南完成剩余步骤。



欲了解有关 Azure 服务运营商的更多信息，请访问 Azure 服务运营商（适用于 Kubernetes）页面。如果您在使用 Azure 服务运营商时遇到问题，请前往 Azure 服务运营商（ASO）故障排除页面寻求帮助。






创建GitHub工作流


----------------------
右键单击您的 AKS 集群，选择 "创建 GitHub 工作流"，即可轻松打开并创建工作流启动模板。这有助于快速生成工作流模板，并预先填充资源组和集群名称，用于以下场景：



• 入门级工作流程


• Helm 工作流  


• Kompose 工作流


• 定制工作流程



通过 Azure 门户创建集群


--------------------------------
右键单击您的 AKS 订阅，选择"从 Azure 门户创建集群"，即可轻松导航至 Azure 门户中的 AKS 创建集群页面。






启动或停止 AKS 集群


 ----------------------------  


右键单击您的 AKS 集群，选择“显示属性”以查看 AKS 集群的相关属性。在该页面上，您可以使用“停止/启动集群”按钮来启停集群。






从您的 AKS 集群运行 Kubectl 命令


------------------------------------------
右键单击您的 AKS 集群，选择“运行 Kubectl 命令”即可在集群上执行 Kubectl 命令。目前，支持执行的 Kubectl 命令如下：



• 描述服务内容

• 获取所有 Pod


• API资源


• 获取集群信息


• 获取 Node 实例


• 获取所有活动信息  


恭喜你！现在你已经掌握了如何在VS Code中使用这个扩展程序了。




下一步计划


----------
• Azure 扩展程序 - VS Code 市场上拥有数百款适用于 Azure 及云端的扩展程序。
 
• Azure Kubernetes 服务诊断（预览版）概述


•  Azure 服务运营商 - 了解 Azure 服务运营商相关信息。


• AKS Periscope


• GitHub AKS 入门工作流  


2022年12月2日


